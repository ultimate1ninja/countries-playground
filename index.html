<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>World Countries Explorer ‚Äî All Countries</title>
  <meta name="description" content="All countries, grouped by continent. Search, sort, kid mode, dark mode." />
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #222;
      --muted: #667085;
      --brand: #0ea5e9;
      --chip: #e0f2fe;
      --chip-text: #075985;
      --border: rgba(0,0,0,.06);
    }
    .dark {
      --bg: #0b0c10;
      --card: #0f1117;
      --text: #f5f7fb;
      --muted: #a1a1aa;
      --brand: #38bdf8;
      --chip: rgba(56,189,248,.18);
      --chip-text: #c9f1ff;
      --border: rgba(255,255,255,.08);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font: 16px/1.45 system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
    }
    header {
      position: sticky; top: 0; z-index: 20;
      backdrop-filter: blur(8px);
      background: color-mix(in srgb, var(--bg) 85%, transparent);
      border-bottom: 1px solid var(--border);
    }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 16px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
    .row > * { flex: 1 1 auto; }
    h1 { margin: 0; font-size: 22px; font-weight: 800; letter-spacing: .2px; display: flex; align-items: center; gap: 8px; }
    .controls { display: grid; grid-template-columns: 1fr minmax(160px, 220px) minmax(160px, 220px) auto auto; gap: 8px; margin-top: 8px; }
    input, select, button {
      appearance: none; border: 1px solid var(--border); background: var(--card); color: var(--text);
      padding: 10px 12px; border-radius: 12px; outline: none;
    }
    button { cursor: pointer; }
    main { padding: 20px 0 40px; }
    section { margin: 24px 0; }
    h2 { margin: 0 0 12px; font-size: 20px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(235px, 1fr));
      gap: 12px;
    }
    .card {
      background: var(--card); border: 1px solid var(--border); border-radius: 14px;
      padding: 12px; box-shadow: 0 1px 4px rgba(0,0,0,.05);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .card:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0,0,0,.08); }
    .flag { width: 100%; height: 120px; object-fit: cover; border-radius: 10px; background: linear-gradient(90deg,#eee,#f7f7f7); }
    .title { display: flex; align-items: center; gap: 8px; margin: 10px 0 6px; }
    .title h3 { margin: 0; font-size: 16px; font-weight: 800; }
    .chip { background: var(--chip); color: var(--chip-text); padding: 3px 8px; border-radius: 999px; font-size: 12px; }
    .meta { font-size: 13px; color: var(--muted); display: grid; gap: 4px; }
    .footer { text-align: center; color: var(--muted); padding: 22px 0; border-top: 1px solid var(--border); }
    .kid .title h3 { font-size: 18px; }
    .kid .meta, .kid input, .kid select, .kid button { font-size: 18px; }
    .err { color: #b45309; padding: 8px 10px; border-radius: 10px; background: #fffbeb; border: 1px solid #fef3c7; }
    .sr { position: absolute; left: -9999px; }
    .muted { color: var(--muted); }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="row">
        <h1>üåç World Countries Explorer</h1>
        <div style="flex:1"></div>
        <button id="darkBtn" title="Toggle dark mode">üåô Dark</button>
        <button id="kidBtn" title="Kid mode: bigger & playful">üë∂ Kid: OFF</button>
      </div>
      <div class="controls">
        <input id="search" type="search" placeholder="Search by name, capital, or language‚Ä¶" />
        <select id="continent">
          <option value="all">All Continents</option>
          <option value="Africa">Africa</option>
          <option value="Americas">Americas</option>
          <option value="Asia">Asia</option>
          <option value="Europe">Europe</option>
          <option value="Oceania">Oceania</option>
          <option value="Antarctic">Antarctic</option>
        </select>
        <select id="sort">
          <option value="name">Sort by Name</option>
          <option value="population">Sort by Population</option>
          <option value="area">Sort by Area</option>
          <option value="density">Sort by Density</option>
        </select>
        <button id="clearBtn" title="Clear filters">Clear</button>
        <button id="jumptoBtn" title="Jump to a random country">üé≤ Random</button>
      </div>
      <div id="status" class="err" style="display:none"></div>
    </div>
  </header>

  <main class="wrap" id="app">
    <p class="muted">Loading all countries‚Ä¶ passports being stamped ‚úàÔ∏è</p>
  </main>

  <footer class="footer">
    Built for kids & adults ‚Äî fast, accessible, and a little silly. Tip: use <kbd>Ctrl/‚åò+F</kbd> to find quickly.
  </footer>

  <script>
    // Feature toggles
    const darkBtn = document.getElementById('darkBtn');
    const kidBtn = document.getElementById('kidBtn');
    const statusEl = document.getElementById('status');
    const app = document.getElementById('app');
    const qs = sel => document.querySelector(sel);

    // Persisted settings
    const persist = {
      get(key, def){ try{ return JSON.parse(localStorage.getItem(key)) ?? def }catch{ return def } },
      set(key, val){ try{ localStorage.setItem(key, JSON.stringify(val)) }catch{} }
    };

    // Dark mode
    const startDark = persist.get('wcx_dark', false);
    if (startDark) document.body.classList.add('dark');
    darkBtn.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è Light' : 'üåô Dark';
    darkBtn.onclick = () => {
      document.body.classList.toggle('dark');
      darkBtn.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è Light' : 'üåô Dark';
      persist.set('wcx_dark', document.body.classList.contains('dark'));
    };

    // Kid mode (bigger fonts, playful labels)
    const kidLabels = on => {
      qs('#sort option[value="name"]').textContent = on ? 'Sort by Name ü§π‚Äç‚ôÇÔ∏è' : 'Sort by Name';
      qs('#sort option[value="population"]').textContent = on ? 'Sort by Population ü§π‚Äç‚ôÇÔ∏è' : 'Sort by Population';
      qs('#sort option[value="area"]').textContent = on ? 'Sort by Area ü§π‚Äç‚ôÇÔ∏è' : 'Sort by Area';
      qs('#sort option[value="density"]').textContent = on ? 'Sort by Density ü§π‚Äç‚ôÇÔ∏è' : 'Sort by Density';
    };
    const startKid = persist.get('wcx_kid', false);
    if (startKid) { document.body.classList.add('kid'); kidBtn.textContent = 'üë∂ Kid: ON'; kidLabels(true); }
    kidBtn.onclick = () => {
      const on = !document.body.classList.contains('kid');
      document.body.classList.toggle('kid');
      kidBtn.textContent = on ? 'üë∂ Kid: ON' : 'üë∂ Kid: OFF';
      kidLabels(on);
      persist.set('wcx_kid', on);
    };

    // Controls
    const searchEl = document.getElementById('search');
    const continentEl = document.getElementById('continent');
    const sortEl = document.getElementById('sort');
    const clearBtn = document.getElementById('clearBtn');
    const jumptoBtn = document.getElementById('jumptoBtn');

    clearBtn.onclick = () => { searchEl.value=''; continentEl.value='all'; sortEl.value='name'; render(); };
    document.addEventListener('keydown', (e)=>{ if(e.key === '/') { e.preventDefault(); searchEl.focus(); } });

    // Data holders
    let ALL = []; // full dataset
    let VIEW = []; // filtered/sorted
    let SECTIONS = {}; // by region -> array

    // Fetch source: mledoze countries dataset (stable)
    const SRC = 'https://raw.githubusercontent.com/mledoze/countries/master/dist/countries.json';

    fetch(SRC)
      .then(r => {
        if (!r.ok) throw new Error('Network error '+r.status);
        return r.json();
      })
      .then(json => {
        // Map to needed fields; add safe defaults and ensure population is read
        const raw = json.map(c => {
          // mledoze format: c.name.common (or c.name) ‚Äî handle both
          const name = (c.name && (c.name.common || c.name.official)) || c.cca3 || 'Unknown';
          const cca2 = (c.cca2 || '').toUpperCase();
          const region = c.region || 'Other';
          const subregion = c.subregion || '';
          const capital = Array.isArray(c.capital) ? c.capital : (c.capital ? [c.capital] : []);
          const population = (typeof c.population === 'number') ? c.population : null;
          const area = (typeof c.area === 'number') ? c.area : null;
          const languages = c.languages ? Object.values(c.languages) : [];
          const timezones = Array.isArray(c.timezones) ? c.timezones : [];
          const borders = Array.isArray(c.borders) ? c.borders : [];
          const landlocked = !!c.landlocked;
          const unMember = !!c.unMember;
          const latlng = Array.isArray(c.latlng) ? c.latlng : [];
          const flagPng = cca2 ? `https://flagcdn.com/w320/${cca2.toLowerCase()}.png` : '';
          return { name, cca2, region, subregion, capital, population, area, languages, timezones, borders, landlocked, unMember, latlng, flagPng };
        });

        // Pakistan recognition filter: hide these names (per your earlier request)
        const PK_BLOCK = new Set(["Israel","Armenia","Taiwan"]);
        ALL = raw.filter(c => !PK_BLOCK.has(c.name));

        // Ensure Western Sahara appears (if absent)
        if (!ALL.some(c => c.name === "Western Sahara")) {
          ALL.push({
            name: "Western Sahara",
            cca2: "EH",
            region: "Africa",
            subregion: "Northern Africa",
            capital: ["Laayoune"],
            population: null,
            area: 266000,
            languages: ["Arabic","Berber"],
            timezones: ["UTC+00:00"],
            borders: ["DZA","MRT","MAR"],
            landlocked: false,
            unMember: false,
            latlng: [24.5, -13.0],
            flagPng: "https://flagcdn.com/w320/eh.png"
          });
        }

        // Sort default by name for consistent initial view
        ALL.sort((a,b) => a.name.localeCompare(b.name, undefined, {sensitivity:'base'}));
        render();
      })
      .catch(err => {
        statusEl.style.display = 'block';
        statusEl.textContent = 'Failed to load countries data. Please check your connection or try again later.';
        app.innerHTML = '<p class="err">Could not load the countries dataset.</p>';
        console.error(err);
      });

    // Helper formatting
    function fmt(n) {
      if (n === null || n === undefined) return 'N/A';
      try { return new Intl.NumberFormat().format(n); } catch { return String(n); }
    }

    // Build a country-specific fact using its attributes (ensures unique-ish facts)
    function makeFact(c){
      const parts = [];

      // Borders/Island/landlocked
      if (c.landlocked) parts.push('This country is landlocked (no coastline).');
      else if (c.borders.length === 0) {
        // probably island or remote territory
        parts.push('This country has no land borders ‚Äî it is an island or isolated by sea.');
      } else {
        parts.push(`It shares land borders with ${c.borders.length} ${c.borders.length===1 ? 'country' : 'countries'}.`);
      }

      // UN membership mention
      if (c.unMember === false) parts.push('It is not a member of the United Nations.');

      // Languages
      if (c.languages && c.languages.length) {
        if (c.languages.length === 1) parts.push(`The primary language listed is ${c.languages[0]}.`);
        else {
          const sample = c.languages.slice(0,3).join(', ');
          parts.push(`It officially lists ${c.languages.length} languages (e.g. ${sample}${c.languages.length>3?', ‚Ä¶':''}).`);
        }
      }

      // Capital
      if (c.capital && c.capital.length) {
        parts.push(`Its capital is ${c.capital.join(', ')}.`);
      } else {
        parts.push('No official capital is listed.');
      }

      // Time zones
      if (c.timezones && c.timezones.length > 1) parts.push(`It spans ${c.timezones.length} time zones.`);

      // Area / population derived statement
      if (c.area && c.population) {
        const density = c.population / c.area;
        let densityText = '';
        if (density < 25) densityText = 'sparsely populated';
        else if (density < 150) densityText = 'moderately populated';
        else densityText = 'densely populated';
        parts.push(`With about ${Math.round(density)} people per km¬≤, it is ${densityText}.`);
      } else if (c.area) {
        if (c.area > 2000000) parts.push('It is among the largest countries by land area.');
        else if (c.area < 1000) parts.push('It is among the smallest countries by land area.');
      } else if (c.population) {
        if (c.population > 100_000_000) parts.push('It is one of the world‚Äôs most populous countries.');
        else if (c.population < 100_000) parts.push('It has a population under 100,000.');
      }

      // Hemisphere
      if (Array.isArray(c.latlng) && c.latlng.length === 2) {
        const [lat, lng] = c.latlng;
        const hemiNS = lat >= 0 ? 'Northern' : 'Southern';
        const hemiEW = lng >= 0 ? 'Eastern' : 'Western';
        parts.push(`Located in the ${hemiNS} & ${hemiEW} Hemispheres.`);
      }

      // Region/subregion
      if (c.subregion) parts.push(`Part of the ${c.subregion} subregion in ${c.region}.`);
      else if (c.region) parts.push(`Located in ${c.region}.`);

      // pick up to 3 unique parts to keep it concise
      const unique = [];
      for (const p of parts) {
        if (!unique.includes(p)) unique.push(p);
        if (unique.length >= 3) break;
      }
      return unique.join(' ');
    }

    // Filter + sort + group
    function computeView() {
      const term = searchEl.value.trim().toLowerCase();
      const regionPick = continentEl.value;
      const sorter = sortEl.value;

      VIEW = ALL.filter(c => {
        if (regionPick !== 'all' && c.region !== regionPick) return false;
        if (!term) return true;
        const hay = [
          c.name,
          (c.capital||[]).join(', '),
          (c.languages||[]).join(', ')
        ].join(' ‚Ä¢ ').toLowerCase();
        return hay.includes(term);
      });

      VIEW.sort((a,b) => {
        if (sorter === 'name') return a.name.localeCompare(b.name);
        if (sorter === 'population') {
          const ap = a.population ?? -1, bp = b.population ?? -1;
          return ap - bp;
        }
        if (sorter === 'area') {
          const aa = a.area ?? -1, ba = b.area ?? -1;
          return aa - ba;
        }
        if (sorter === 'density') {
          const da = (a.area && a.population) ? a.population / a.area : -1;
          const db = (b.area && b.population) ? b.population / b.area : -1;
          return da - db;
        }
        return 0;
      });

      // group into sections
      SECTIONS = {};
      for (const c of VIEW) {
        const key = c.region || 'Other';
        (SECTIONS[key] ||= []).push(c);
      }
    }

    function card(c) {
      const density = (c.area && c.population) ? (c.population / c.area).toFixed(1) : '‚Äî';
      const capital = c.capital && c.capital.length ? c.capital.join(', ') : '‚Äî';
      const langs = c.languages && c.languages.length ? c.languages.join(', ') : '‚Äî';
      const fact = makeFact(c);
      return `
        <article class="card" id="card-${c.cca2 || c.name.replace(/\\W+/g,'-')}">
          <img class="flag" loading="lazy" src="${c.flagPng}" alt="Flag of ${c.name}" onerror="this.style.opacity=.4">
          <div class="title"><h3>${c.name}</h3><span class="chip" title="Region">${c.region}</span>${c.subregion?`<span class="chip" title="Subregion">${c.subregion}</span>`:''}</div>
          <div class="meta">
            <div><strong>${document.body.classList.contains('kid')?'Capital ü§π‚Äç‚ôÇÔ∏è':'Capital'}:</strong> ${capital}</div>
            <div><strong>${document.body.classList.contains('kid')?'Population ü§π‚Äç‚ôÇÔ∏è':'Population'}:</strong> ${fmt(c.population)}</div>
            <div><strong>${document.body.classList.contains('kid')?'Area ü§π‚Äç‚ôÇÔ∏è':'Area'}:</strong> ${fmt(c.area)} km¬≤</div>
            <div><strong>${document.body.classList.contains('kid')?'Density ü§π‚Äç‚ôÇÔ∏è':'Density'}:</strong> ${density === '‚Äî' ? '‚Äî' : density + ' /km¬≤'}</div>
            <div><strong>${document.body.classList.contains('kid')?'Languages ü§π‚Äç‚ôÇÔ∏è':'Languages'}:</strong> ${langs}</div>
          </div>
          <div class="meta" style="margin-top:6px; font-style:italic;">${fact}</div>
        </article>
      `;
    }

    function render() {
      computeView();
      if (!VIEW.length) { app.innerHTML = '<p class="err">No countries match your filters.</p>'; return; }

      const order = ['Africa','Americas','Asia','Europe','Oceania','Antarctic','Other'];
      const parts = [];
      for (const region of order) {
        const arr = SECTIONS[region];
        if (!arr || !arr.length) continue;
        parts.push(`
          <section id="${region.toLowerCase()}">
            <h2>${icon(region)} ${region} <span class="chip">${arr.length}</span></h2>
            <div class="grid">
              ${arr.map(card).join('')}
            </div>
          </section>
        `);
      }
      app.innerHTML = parts.join('\n');
    }

    function icon(region){
      return ({
        Africa:'üåç', Americas:'üåé', Asia:'üåè', Europe:'üè∞', Oceania:'üåä', Antarctic:'‚ùÑÔ∏è', Other:'üß≠'
      })[region] || 'üß≠';
    }

    // Wire up live controls
    ['input','change'].forEach(evt => {
      searchEl.addEventListener(evt, render);
      continentEl.addEventListener(evt, render);
      sortEl.addEventListener(evt, render);
    });

    // Jump to random card on screen after filters applied
    jumptoBtn.onclick = () => {
      const cards = app.querySelectorAll('.card');
      if (!cards.length) return;
      const pick = cards[Math.floor(Math.random()*cards.length)];
      pick.scrollIntoView({behavior:'smooth', block:'center'});
      pick.style.outline = '3px solid var(--brand)';
      setTimeout(()=>{ pick.style.outline='none'; }, 900);
    };
  </script>
</body>
</html>
